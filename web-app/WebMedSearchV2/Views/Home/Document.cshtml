@{
    ViewBag.Title = "Document";
}

<div class="container">
    <div id="contentDiv">
        <div id="titleDiv"></div>
        <div id="metadataDiv"></div>
        <div id="summaryDiv"></div>
        <div id="abstractDiv"></div>
        <div id="bodyDiv"></div>
    </div>
</div>


<script>
    var queryTerms = ''
	$(function () {
        LookUp();
    });
    
    function LookUp() {
        var query_string = {};
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        queryTermsArray = JSON.parse(decodeURIComponent((query.split("&")[1].substring(6)+'').replace(/\+/g, '%20')))
        queryTerms = ''
        for (var qt in queryTermsArray) {
            queryTerms += queryTermsArray[qt]["value"] + " "
        }
        if (vars.length > 0) {
            $.ajax({
                type: "POST", url: "/search/doc",
                success: function (data) {
                    UpdatePageContent(data);
                },
                data: {
                    "docID": vars[0].substring(6)
                },
                accept: 'application/json'
            });
        }

    }




    function UpdatePageContent(data) {

        $('#titleDiv').html('<h3>' + data["title"] + '</h3>')


        //htmlString = '<b>Paper ID:</b> ' + data["docID"] + '<br><br>'
        htmlString = '<b>Original Source:</b> <a href="' + data["fullTextURL"] + '" target="_blank">Link to Full Article</a><br><br>'
        htmlString += '<h4>Authors</h4> <ul>'
        for (var author in data["contributors"]) {
            htmlString += '<li>' + data["contributors"][author] + '</li>'
        }
        htmlString += '</ul>'
        $('#metadataDiv').html(htmlString)

        htmlString = '<h4>Abstract</h4>'
        htmlString += '<p>' + data["abstractContent"] + '</p>'
        $('#abstractDiv').html(htmlString)

        htmlString = '<h4>Body</h4>'
        htmlString += '<p>' + data["body"] + '</p>'
        $('#bodyDiv').html(htmlString)


        // Generate the contextual summary
        urlDecodedQuery = urldecode(queryTerms)
        $('#summaryDiv').html("<b style='color:blue'>Generating a contextual summary using query: \"" + urlDecodedQuery + "\"...</b><br><br>")

            //    $.post('/search/GetContentSummary',
            //{
            //    "query": queryTerms,
            //    "title": data["title"],
            //    "body": data["abstractContent"] + "." + data["body"]
            //},
            //function (data) {
            //    dataset = JSON.parse(data);
            //    for (var summary in dataset["summary"])
            //    {
            //        for (sentence in summary["sentences"])
            //        {

            //        }

            //    }

            //});


        $.ajax({
            type: "POST", url: "/search/GetContentSummary",
            success: function (data) {
                jsonData = JSON.parse(data)

                $('#summaryDiv').html("<h4>Contextual Summary (generated by <a href='http://www.agolo.com' target='_blank'>Agolo</a>)</h4>")
                $('#summaryDiv').append('<ul>')
                for (var summary in jsonData["summary"])
                {
                    for (sentence in jsonData["summary"][summary]["sentences"])
                    {
                        $('#summaryDiv').append('<li>' + jsonData["summary"][summary]["sentences"][sentence] + '</li>')

                    }

                }
                $('#summaryDiv').append('</ul><br>')

            },
            data: {
                "query": queryTerms,
                "title": data["title"],
                "body": data["abstractContent"] + "." + data["body"]

            },
            error: function (ajaxContext) {
                alert(ajaxContext.responseText)
            }
            //, accept: 'application/json'
        });


    }

    function urldecode(str) {
       return decodeURIComponent((str+'').replace(/\+/g, '%20'));
    }
</script>

